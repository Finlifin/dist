import{_ as L,u as U,r as i,c as E,o as W,a as y,b,d as t,n as J,e as H,f as B,t as $,p as j,g as z,i as M,h as K,j as X,E as N,k as G,l as P,F as Q,m as Y,w as Z,v as ee,q as te,s as se,x as oe,y as R,z as D}from"./index-474a8a88.js";const ae=a=>(j("data-v-8ce6bc45"),a=a(),z(),a),ne={class:"main"},ce={class:"metainfo"},le={class:"username"},ie=ae(()=>t("div",{class:"decoration"},null,-1)),re={class:"content"},de={class:"chat-message"},ue={class:"time-stamp"},ge={class:"TimeLine"},me={__name:"chatMessage",props:{avatarSelected:Number},emits:["messageHeight"],setup(a,{emit:p}){const C=a;U();const u=i(new Date),h=E(()=>{const o=u.value.getHours(),m=u.value.getMinutes(),I=u.value.getSeconds();return`${o}:${m<10?"0":""}${m}:${I<10?"0":""}${I}`}),k=E(()=>({width:"3rem",height:"3rem",background:`url(/头像${C.avatarSelected+1}.jpg) no-repeat center center`,backgroundSize:"cover",borderRadius:"50%"})),g=i(null);let v=0,c=0,_=0,l=0,S=0;const w=o=>{p("messageHeight",o)};W(()=>{if(g.value){const o=getComputedStyle(g.value);v=g.value.clientHeight,c=parseInt(o.marginTop),_=parseInt(o.marginBottom),l=parseInt(o.paddingTop),S=parseInt(o.paddingBottom),w(r())}});const r=()=>v+c+_+l+S;return(o,m)=>(y(),b("div",{class:"msg",ref_key:"chatMessage",ref:g},[t("div",ne,[t("div",ce,[t("div",{style:J(H(k))},null,4),t("div",le,[B(o.$slots,"username",{},void 0,!0)])]),ie,t("div",re,[t("div",de,[B(o.$slots,"msg",{},void 0,!0)])])]),t("div",ue,[t("div",ge,"-"+$(H(h))+"-",1)])],512))}},pe=L(me,[["__scopeId","data-v-8ce6bc45"]]);const he=a=>(j("data-v-4e478742"),a=a(),z(),a),ve={class:"room"},_e={class:"intent-area"},Se=he(()=>t("div",null,"➠",-1)),fe=[Se],ye={__name:"ChatRoom",setup(a){let p=i(0);const{data:C,setOnlineCountData:u}=M("onlineCountData"),h=K(),k=X(),{data:g,setShow:v}=M("isShow");v(k.meta.isShow);const c=i(""),_=i(null),l=i(null),S=()=>{const e=l.value;e&&e.scrollTo({top:e.scrollHeight,behavior:"smooth"})};function w(){const e=l.value;return parseInt(e.scrollTop)==e.scrollHeight-e.clientHeight-f.value||parseInt(e.scrollTop)-1==e.scrollHeight-e.clientHeight-f.value||parseInt(e.scrollTop)+1==e.scrollHeight-e.clientHeight-f.value}const r=U();W(()=>{m(),o()});const o=()=>{N({type:"success",message:r.WelcomeUser,duration:1500})};function m(){let e=localStorage.getItem("username");e?(r.username=e,h.push("/chatRoom")):h.push("/Login")}G(()=>{w()&&(l.value.scrollTop=l.value.scrollHeight)});const T=`ws://chat.kexie.space/api/chat/${localStorage.getItem("username")}`,d=new WebSocket(T),{data:ke,setEmitSocket:O}=M("EmitSocket");O(d),d.onopen=()=>{console.log("监听到打开事件---WebSocket链接建立成功!")},d.onmessage=V;function V(e){console.log("监听到消息事件---WebSocket消息接收成功!");const s=JSON.parse(e.data);if(s.data.type=="onlineCountChanged"&&(p.value=s.data.onlineCountNow,u(p.value)),s.data.type=="incomingMsg"){let n={message:s.data.content,avatarSelected:s.data.senderAvatarId,username:s.data.name};r.addMessage(n)}}function q(){console.log("监听到关闭事件---WebSocket链接关闭!")}d.onclose=q,P(()=>{d.close()});const f=i(0),A=e=>{f.value=e};function x(){if(c.value.trim()==""){N({type:"error",message:"请不要输入空消息!!!",duration:1500});return}let e=c.value.trim(),s=JSON.stringify({type:"msg",msg:e,sender:localStorage.getItem("ID"),avatarSelected:localStorage.getItem("avatarSelected")});d.send(s),c.value=""}return(e,s)=>(y(),b("div",ve,[t("div",{class:"msg-stage",ref_key:"containerRef",ref:l},[(y(!0),b(Q,null,Y(H(r).messageList,(n,F)=>(y(),oe(pe,{avatarSelected:n.avatarSelected,key:F,onMessageHeight:A},{msg:R(()=>[D($(n.message),1)]),username:R(()=>[D($(n.username),1)]),_:2},1032,["avatarSelected"]))),128)),t("div",{ref_key:"messagesEnd",ref:_},null,512)],512),t("div",_e,[Z(t("input",{inputmode:"text",class:"input input-alt",placeholder:"请发送你的消息!",required:"","onUpdate:modelValue":s[0]||(s[0]=n=>c.value=n),rows:2,type:"textarea",onKeyup:s[1]||(s[1]=te(n=>x(),["enter"]))},null,544),[[ee,c.value]]),t("button",{class:"send-btn",onClick:s[2]||(s[2]=se(n=>x(),["prevent"]))},fe)]),t("div",null,[t("button",{class:"scroll-to-bottom",onClick:S}," ↓ ")])]))}},Ie=L(ye,[["__scopeId","data-v-4e478742"]]);export{Ie as default};
